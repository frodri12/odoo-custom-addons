<?xml version="1.0" encoding="utf-8"?>

<odoo>
    <data>

        <!-- this header can be used on any Argentinean report, to be useful some variables should
        be passed -->
        <template id="custom_header">
            <div class="mb-3">
                <div class="row">
                    <div name="left-upper-side" class="col-5" t-if="not pre_printed_report">
                        <img t-if="o.company_id.logo" t-att-src="image_data_uri(o.company_id.logo)"
                            style="max-height: 45px;" alt="Logo" />
                    </div>
                    <div name="center-upper" class="col-2 text-center"
                        t-att-style="'color: %s;' % o.company_id.primary_color">
                        <span style="display: inline-block; text-align: center; line-height: 8px;">
                            <h1 style="line-height: 35px;">
                                <strong>
                                    <span
                                        t-out="not pre_printed_report and document_letter or '&#160;'" />
                                </strong>
                            </h1>
                            <span style="font-size: x-small;"
                                t-out="not pre_printed_report and document_legend or '&#160;'" />
                        </span>
                    </div>
                    <div name="right-upper-side" class="col-5 text-end" style="padding-left: 0px;"
                        t-if="not pre_printed_report">

                        <!-- (6) Titulo de Documento -->
                        <h4 t-att-style="'color: %s;' % o.company_id.primary_color">
                            <strong>
                                <span t-out="report_name" />
                            </strong>
                        </h4>

                    </div>
                </div>
                <div class="row">
                    <div class="col-6" style="padding-right: 0px;">
                        <t t-if="not pre_printed_report">
                            <!-- (1) Nombre de Fantasia -->
                            <!-- (2) Apellido y Nombre o Razon Social -->
                            <span t-field="o.company_id.partner_id.name" />

                            <!-- (3) Domicilio Comercial (Domicilio Fiscal is the same) -->
                            <br />
                            <div></div>
                            <!-- we dont use the address widget as it adds a new line on the phone
                            and we want to reduce at maximum lines qty -->
                            <t
                                t-out="' - '.join([item for item in [
                            ', '.join([item for item in [header_address.street, header_address.street2] if item]),
                            header_address.city,
                            header_address.state_id and header_address.state_id.name,
                            header_address.zip,
                            header_address.country_id and header_address.country_id.name] if item])" />
                            <span t-if="header_address.phone"> - </span>
                            <span t-if="header_address.phone" style="white-space: nowrap;"
                                t-out="'Tel: ' + header_address.phone" />
                            <br />
                            <span t-att-style="'color: %s;' % o.company_id.primary_color"
                                t-out="' - '.join([item for item in [(header_address.website or '').replace('https://', '').replace('http://', ''), header_address.email] if item])" />
                        </t>
                    </div>
                    <div class="col-6 text-end" style="padding-left: 0px;">

                        <t t-if="not pre_printed_report">
                            <!-- (7) Numero punto venta - (8) numero de documento -->
                            <span t-att-style="'color: %s;' % o.company_id.secondary_color">Nro: </span>
                            <span t-out="report_number" />
                        </t>
                        <br />

                        <!-- (9) Fecha -->
                        <span t-att-style="'color: %s;' % o.company_id.secondary_color">Date: </span>
                        <span t-out="report_date" t-options='{"widget": "date"}' />

                        <t t-if="not pre_printed_report">
                            <!-- (5) Condicion de IVA / Responsabilidad -->
                            <!-- (10) CUIT -->
                            <br />
                            <span t-field="o.company_id.l10n_ar_afip_responsibility_type_id" />
                            <span t-att-style="'color: %s;' % o.company_id.secondary_color"> - CUIT: </span>
                            <span t-field="o.company_id.partner_id.l10n_ar_formatted_vat" />

                            <!-- (11) IIBB: -->
                            <!-- (12) Inicio de actividades -->
                            <br />
                            <span t-att-style="'color: %s;' % o.company_id.secondary_color">IIBB: </span>
                            <span
                                t-out="o.company_id.l10n_ar_gross_income_type == 'exempt' and 'Exento' or o.company_id.l10n_ar_gross_income_number" />
                            <span t-att-style="'color: %s;' % o.company_id.secondary_color"> -
                                Activities Start: </span>
                            <span t-field="o.company_id.l10n_ar_afip_start_date" />
                        </t>

                    </div>
                </div>
            </div>
        </template>

        <template id="kude_invoice_header_customer">
            <div id="informations" class="row mt8 mb8">
                <div class="col-6">
                    <!-- IDENTIFICACION (ADQUIRIENTE-LOCATARIO-PRESTARIO) -->

                    <!-- Apellido y Nombre: Denominicacion o Razon Soclial -->
                    <t t-if="o.is_sale_document(include_receipts=True)">
                        <strong>Customer: </strong>
                    </t>
                    <t t-else="">
                        <strong>Supplier: </strong>
                    </t>
                    <span t-field="o.partner_id.commercial_partner_id.name" />

                    <!-- Domicilio Comercial -->
                    <br />
                    <span t-field="o.partner_id"
                        t-options="{'widget': 'contact', 'fields': ['address'], 'no_marker': true, 'no_tag_br': True}" />

                    <!-- RUC or CI (FALTA) -->
                </div>
            </div>
        </template>

        <!-- Encabezados de la tabla de detalle -->
        <template id="kude_invoice_thead">
            <thead>
                <tr>
                    <th name="th_product_code" class="text-start">
                        <span>Product Code</span>
                    </th>
                    <th name="th_product_name" class="text-start">
                        <span>Product Name</span>
                    </th>
                    <th name="th_quantity" class="text-end">
                        <span>Quantity</span>
                    </th>
                    <th name="th_priceunit" t-attf-class="text-end text-nowrap">
                        <span>Unit Price</span>
                    </th>
                    <th name="th_discount" t-if="display_discount"
                        t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                        <span>Discount</span>
                    </th>
                    <th name="th_total_exempt" class="text-end">
                        <span>Total Exempt</span>
                    </th>
                    <th name="th_total_taxed5" class="text-end">
                        <span>Taxed 5%</span>
                    </th>
                    <th name="th_total_taxed10" class="text-end">
                        <span>Taxed 10%</span>
                    </th>
                </tr>
            </thead>
        </template>

        <!-- Detalle de la factura -->
        <template id="kude_invoice_tbody">
            <tbody class="invoice_tbody">
                <t t-set="current_subtotal" t-value="0" />
                <t t-set="current_total" t-value="0" />
                <t t-set="total_exempt" t-value="0" />
                <t t-set="total_taxed5" t-value="0" />
                <t t-set="total_taxed10" t-value="0" />
                <t t-set="lines"
                    t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)" />
                <t t-foreach="lines" t-as="line">

                    <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" />
                    <t t-set="current_total" t-value="current_total + line.price_total" />

                    <t t-set="total_exempt" t-value="total_exempt + line.l10n_aipy_price_unit_iva0" />
                    <!-- Le falta sumar el IVA cuando la base es distinta de 100 y 0 -->
                    <t t-set="total_taxed5" t-value="total_taxed5 + line.l10n_aipy_price_unit_iva5" />
                    <t t-set="total_taxed10"
                        t-value="total_taxed10 + line.l10n_aipy_price_unit_iva10" />
                    <tr
                        t-att-class="'fw-bold o_line_section' if line.display_type == 'line_section' else 'fst-italic o_line_note' if line.display_type == 'line_note' else ''">
                        <t t-if="line.display_type == 'product'"
                            name="account_invoice_line_accountable">

                            <td name="td_product_code" class="text-start text-nowrap">
                                <t t-set="product_code"
                                    t-value="line.product_id.default_code if line.product_id.default_code else line.product_id.id" />
                                <span t-out="product_code">COD</span>
                            </td>
                            <td name="account_invoice_line_name">
                                <span t-if="line.name" t-field="line.name"
                                    t-options="{'widget': 'text'}">Bacon Burger</span>
                            </td>
                            <td name="td_quantity" class="text-end text-nowrap">
                                <span t-field="line.quantity">3.00</span>
                                <span t-field="line.product_uom_id.name">units</span> <!--
                                groups="uom.group_uom" -->
                            </td>
                            <td name="td_price_unit"
                                t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                <span class="text-nowrap" t-field="line.price_unit"
                                    t-options='{"widget": "monetary", "display_currency": o.currency_id}'>
                                    9.00</span>
                            </td>
                            <td name="td_discount" t-if="display_discount"
                                t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                <span class="text-nowrap" t-field="line.discount">0</span>
                            </td>

                            <td name="td_total_exempt"
                                t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                <span class="text-nowrap" t-field="line.l10n_aipy_price_unit_iva0"
                                    t-options='{"widget": "monetary", "display_currency": o.currency_id}'>
                                    0</span>
                            </td>
                            <td name="td_total_taxed5"
                                t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                <span class="text-nowrap" t-field="line.l10n_aipy_price_unit_iva5"
                                    t-options='{"widget": "monetary", "display_currency": o.currency_id}'>
                                    0</span>
                            </td>
                            <td name="td_total_taxed10"
                                t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                <span class="text-nowrap" t-field="line.l10n_aipy_price_unit_iva10"
                                    t-options='{"widget": "monetary", "display_currency": o.currency_id}'>
                                    0</span>
                            </td>

                        </t>
                        <!-- Para generar subtotales cuando se agrega una seccion -->
                        <t t-elif="line.display_type == 'line_section'">
                            <td colspan="99">
                                <span t-if="line.name" t-field="line.name"
                                    t-options="{'widget': 'text'}">A section title</span>
                            </td>
                            <t t-set="current_section" t-value="line" />
                            <t t-set="current_subtotal" t-value="0" />
                        </t>
                        <!-- Muestra la nota como linea de factura -->
                        <t t-elif="line.display_type == 'line_note'">
                            <td colspan="99">
                                <span t-if="line.name" t-field="line.name"
                                    t-options="{'widget': 'text'}">A note, whose content usually
                                    applies to the section or product above.</span>
                            </td>
                        </t>
                    </tr>
                    <!-- Muestra el subtotal de la seccion -->
                    <!--
                    <t
                        t-if="current_section and (line_last or lines[line_index+1].display_type == 'line_section')">
                        <tr class="is-subtotal text-end">
                            <td colspan="99">
                                <strong class="mr16">Subtotal</strong>
                                <span
                                    t-out="current_subtotal"
                                    t-options='{"widget": "monetary", "display_currency": o.currency_id}'
                                >
                                    31.05</span>
                            </td>
                        </tr>
                    </t>
                    -->
                </t>
                <!-- Nueva linea de subtotales -->
                <tr t-att-class="'fw-bold o_line_section o_line_note'"
                    style="border-top: 1px solid #111827">
                    <td class="text-start text-nowrap"></td>
                    <td>
                        <span t-options="{'widget': 'text'}">SUBTOTALES:</span>
                    </td>
                    <td class="text-end text-nowrap"> </td>
                    <td
                        t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}"> </td>
                    <td t-if="display_discount"
                        t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                        <span class="text-nowrap"
                            t-options='{"widget": "monetary", "display_currency": o.currency_id}'> </span>
                    </td>
                    <td
                        t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                        <span class="text-nowrap" t-out="total_exempt"
                            t-options='{"widget": "monetary", "display_currency": o.currency_id}'>0</span>
                    </td>
                    <td
                        t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                        <span class="text-nowrap" t-out="total_taxed5"
                            t-options='{"widget": "monetary", "display_currency": o.currency_id}'>0</span>
                    </td>
                    <td
                        t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                        <span class="text-nowrap" t-out="total_taxed10"
                            t-options='{"widget": "monetary", "display_currency": o.currency_id}'>0</span>
                    </td>
                </tr>
            </tbody>
        </template>

        <template id="document_tax_totals_company_currency_template">
            <t t-set="currency" t-value="o.company_currency_id" />
            <t t-set="same_tax_base" t-value="tax_totals['same_tax_base']" />
        </template>

        <template id="report_invoice_document" inherit_id="account.report_invoice_document"
            primary="True">

            <xpath expr="//*[@t-call='web.external_layout']" position="replace">
                <t t-call="web.external_layout">


                    <t t-set="o" t-value="o.with_context(lang=lang)" />
                    <t t-set="forced_vat" t-value="o.fiscal_position_id.foreign_vat" />
                    <!-- <t t-set="custom_header" t-value="'l10n_aipy.custom_header'" /> -->
                    <t t-set="report_date" t-value="o.invoice_date" />
                    <t t-set="report_number" t-value="o.l10n_latam_document_number" />
                    <t t-set="pre_printed_report"
                        t-value="report_type == 'pdf'" />
                    <t t-set="document_letter"
                        t-value="A" />
                    <t t-set="document_legend"
                        t-value="201" />
                    <t t-set="report_name" t-value="o.l10n_latam_document_type_id.report_name" />
                    <t t-set="header_address" t-value="o.company_id.partner_id" />

                    <t t-set="custom_footer2">
                        <div class="row">
                            <div name="footer_left_column" class="col-8 text-start">
                            </div>
                            <div name="footer_right_column" class="col-4 text-end">
                                <div name="pager" t-if="report_type == 'pdf'"> Page: <span
                                        class="page" /> / <span class="topage" />
                                </div>
                            </div>
                        </div>
                    </t>

                    <!-- So that
                    it appears in the footer of the report instead of the company VAT if it's set -->
                    <div class="row">
                        <t t-if="o.partner_shipping_id and (o.partner_shipping_id != o.partner_id)">
                            <div class="col-6">
                                <t t-set="information_block">
                                    <div groups="account.group_delivery_invoice_address"
                                        name="shipping_address_block">
                                        <strong>Shipping Address</strong>
                                        <div t-field="o.partner_shipping_id"
                                            t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}' />
                                    </div>
                                </t>
                            </div>
                            <!-- remove default partner address - l10n_ar -->
                            <!--
                            <div class="col-6" name="address_not_same_as_shipping">
                                
                                <t t-set="address">
                                    <address class="mb-0" t-field="o.partner_id"
                                        t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}' />
                                    <div t-if="o.partner_id.vat"
                                        id="partner_vat_address_not_same_as_shipping">
                                        <t t-if="o.company_id.account_fiscal_country_id.vat_label"
                                            t-out="o.company_id.account_fiscal_country_id.vat_label"
                                            id="inv_tax_id_label" />
                                        <t t-else="">Tax ID</t>: <span
                                            t-field="o.partner_id.vat" />
                                    </div>
                                </t>
                            </div>
                            -->
                            <div name="address_not_same_as_shipping" />
                        </t>
                        <t
                            t-elif="o.partner_shipping_id and (o.partner_shipping_id == o.partner_id)">
                            <!-- remove default partner address - l10n_ar 
                            <div class="offset-col-6 col-6" name="address_same_as_shipping">
                                <t t-set="address">
                                    <address class="mb-0" t-field="o.partner_id"
                                        t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}' />
                                    <div t-if="o.partner_id.vat"
                                        id="partner_vat_address_same_as_shipping">
                                        <t t-if="o.company_id.account_fiscal_country_id.vat_label"
                                            t-out="o.company_id.account_fiscal_country_id.vat_label"
                                            id="inv_tax_id_label" />
                                        <t t-else="">Tax ID</t>: <span
                                            t-field="o.partner_id.vat" />
                                    </div>
                                </t>
                            </div>
                            -->
                            <div name="address_not_same_as_shipping" />
                        </t>
                        <t t-else="">
                            <!-- remove default partner address - l10n_ar
                            <div class="offset-col-6 col-6" name="no_shipping">
                                <t t-set="address">
                                    <address class="mb-0" t-field="o.partner_id"
                                        t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}' />
                                    <div t-if="o.partner_id.vat" id="partner_vat_no_shipping">
                                        <t t-if="o.company_id.account_fiscal_country_id.vat_label"
                                            t-out="o.company_id.account_fiscal_country_id.vat_label"
                                            id="inv_tax_id_label" />
                                        <t t-else="">Tax ID</t>: <span
                                            t-field="o.partner_id.vat" />
                                    </div>
                                </t>
                            </div>
                            -->
                            <div name="no_shipping" />
                        </t>
                    </div>
                    <div class="clearfix invoice_main">
                        <div class="page mb-4">
                            <!-- Tipo y numero de documento -->
                            <!-- remove default document title - l10n_ar
                            <t t-set="layout_document_title">
                                <span t-if="o.move_type == 'out_invoice' and o.state == 'posted'">
                                    Invoice</span>
                                <span t-elif="o.move_type == 'out_invoice' and o.state == 'draft'">Draft
                                    Invoice</span>
                                <span t-elif="o.move_type == 'out_invoice' and o.state == 'cancel'">Cancelled
                                    Invoice</span>
                                <span t-elif="o.move_type == 'out_refund' and o.state == 'posted'">Credit
                                    Note</span>
                                <span t-elif="o.move_type == 'out_refund' and o.state == 'draft'">Draft
                                    Credit Note</span>
                                <span t-elif="o.move_type == 'out_refund' and o.state == 'cancel'">Cancelled
                                    Credit Note</span>
                                <span t-elif="o.move_type == 'in_refund'">Vendor Credit Note</span>
                                <span t-elif="o.move_type == 'in_invoice'">Vendor Bill</span>
                                <span t-if="o.name and o.name != '/'" t-field="o.name">INV/2023/0001</span>
                            </t>
                            -->
                            <div class="oe_structure"></div>
                            <div id="informations" class="row mb-4">
                                <div class="col" t-if="o.invoice_date" name="invoice_date">
                                    <t t-if="o.move_type == 'out_invoice'">
                                        <strong>Invoice Date</strong>
                                    </t>
                                    <t t-elif="o.move_type == 'out_refund'">
                                        <strong>Credit Note Date</strong>
                                    </t>
                                    <t t-elif="o.move_type == 'out_receipt'">
                                        <strong>Receipt Date</strong>
                                    </t>
                                    <t t-else="">
                                        <strong>Date</strong>
                                    </t>
                                    <div t-field="o.invoice_date">2023-09-12</div>
                                </div>
                                <div class="col"
                                    t-if="o.invoice_date_due and o.move_type == 'out_invoice' and o.state == 'posted'"
                                    name="due_date">
                                    <strong>Due Date</strong>
                                    <div t-field="o.invoice_date_due">2023-10-31</div>
                                </div>
                                <div class="col" t-if="o.delivery_date" name="delivery_date">
                                    <strong>Delivery Date</strong>
                                    <div t-field="o.delivery_date">2023-09-25</div>
                                </div>
                                <div class="col" t-if="o.invoice_origin" name="origin">
                                    <strong>Source</strong>
                                    <div t-field="o.invoice_origin">SO123</div>
                                </div>
                                <div class="col" t-if="o.partner_id.ref" name="customer_code">
                                    <strong>Customer Code</strong>
                                    <div t-field="o.partner_id.ref" />
                                </div>
                                <div class="col" t-if="o.ref" name="reference">
                                    <strong>Reference</strong>
                                    <div t-field="o.ref">INV/2023/00001</div>
                                </div>
                                <div class="col" t-if="o.invoice_incoterm_id" name="incoterm_id">
                                    <strong>Incoterm</strong>
                                    <div t-if="o.incoterm_location">
                                        <span t-field="o.invoice_incoterm_id.code" />
                                        <br />
                                        <span t-field="o.incoterm_location" />
                                    </div>
                                    <div t-else="" t-field="o.invoice_incoterm_id.code" class="m-0" />
                                </div>
                            </div>
                            <!-- Detalle de la factura-->
                            <t t-set="display_discount"
                                t-value="any(l.discount for l in o.invoice_line_ids)" />
                            <div class="oe_structure"></div>
                            <table class="o_has_total_table table o_main_table table-borderless"
                                name="invoice_line_table">
                                <t t-call="l10n_aipy.kude_invoice_thead" />
                                <t t-call="l10n_aipy.kude_invoice_tbody" />
                            </table>
                            <div>
                                <div id="right-elements"
                                    t-attf-class="#{'col-5' if report_type != 'html' else 'col-12 col-md-5'} ms-5 d-inline-block float-end">
                                    <div id="total" class="clearfix row mt-n3">
                                        <div class="ms-auto">
                                            <table
                                                class="o_total_table table table-borderless avoid-page-break-inside">

                                                <!-- Tax totals summary (invoice currency) -->
                                                <t t-if="o.tax_totals"
                                                    t-call="l10n_aipy.document_tax_totals">
                                                    <t t-set="tax_totals" t-value="o.tax_totals" />
                                                    <t t-set="currency" t-value="o.currency_id" />
                                                </t>

                                                <!--Payments-->
                                                <t t-if="print_with_payments">
                                                    <t t-if="o.payment_state != 'invoicing_legacy'">
                                                        <t t-set="payments_vals"
                                                            t-value="o.sudo().invoice_payments_widget and o.sudo().invoice_payments_widget['content'] or []" />
                                                        <t t-foreach="payments_vals"
                                                            t-as="payment_vals">
                                                            <tr
                                                                t-if="payment_vals['is_exchange'] == 0">
                                                                <td>
                                                                    <i
                                                                        class="oe_form_field text-end oe_payment_label">Paid
                                                                        on <t
                                                                            t-out="payment_vals['date']"
                                                                            t-options='{"widget": "date"}'>
                                                                        2021-09-19</t></i>
                                                                </td>
                                                                <td class="text-end">
                                                                    <span
                                                                        t-out="payment_vals['amount']"
                                                                        t-options='{"widget": "monetary", "display_currency": o.currency_id}'>
                                                                        20.00</span>
                                                                </td>
                                                            </tr>
                                                        </t>
                                                        <t t-if="len(payments_vals) > 0">
                                                            <tr class="fw-bold">
                                                                <td>Amount Due</td>
                                                                <td class="text-end">
                                                                    <span
                                                                        t-field="o.amount_residual">
                                                                        11.05</span>
                                                                </td>
                                                            </tr>
                                                        </t>
                                                    </t>
                                                </t>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- Tax totals summary (company currency) -->
                                    <t t-if="o.tax_totals.get('display_in_company_currency')">
                                        <t t-set="tax_totals" t-value="o.tax_totals" />
                                        <t
                                            t-call="l10n_aipy.document_tax_totals_company_currency_template" />
                                    </t>
                                    <t t-else="">
                                        <div class="oe_structure" />
                                    </t>
                                </div>
                                <div id="payment_term" class="clearfix overflow-auto">
                                    <!-- Notas del fisco -->
                                    <div class="justify-text">
                                        <p t-if="not is_html_empty(o.fiscal_position_id.note)"
                                            name="note" class="mb-2">
                                            <span t-field="o.fiscal_position_id.note" />
                                        </p>
                                    </div>
                                    <!-- Notas que se deben agregar a la factura -->
                                    <div class="justify-text">
                                        <p t-if="not is_html_empty(o.taxes_legal_notes)"
                                            name="taxes_legal_notes" class="mb-2">
                                            <span t-field="o.taxes_legal_notes" />
                                        </p>
                                    </div>
                                    <t t-set="payment_term_details" t-value="o.payment_term_details" />
                                    <!-- Condiciones de pago -->
                                    <div class="mb-3">
                                        <span id="payment_terms_note_id"
                                            t-if="o.invoice_payment_term_id.note"
                                            t-field="o.invoice_payment_term_id.note"
                                            name="payment_term">Payment within 30 calendar day</span>
                                        <br />
                                        <t
                                            t-if="o.invoice_payment_term_id.display_on_invoice and payment_term_details">
                                            <div t-if='o.show_payment_term_details'
                                                id="total_payment_term_details_table" class="row">
                                                <div
                                                    t-attf-class="#{'col-10' if report_type != 'html' else 'col-sm-10 col-md-9'}">
                                                    <t
                                                        t-if="o._is_eligible_for_early_payment_discount(o.currency_id,o.invoice_date)">
                                                        <td>
                                                            <span
                                                                t-options='{"widget": "monetary", "display_currency": o.currency_id}'
                                                                t-out="o.invoice_payment_term_id._get_amount_due_after_discount(o.amount_total, o.amount_tax)">
                                                            30.00</span> due if paid before <span
                                                                t-out="o.invoice_payment_term_id._get_last_discount_date_formatted(o.invoice_date)">
                                                            2024-01-01</span>
                                                        </td>
                                                    </t>
                                                    <t t-if="len(payment_term_details) > 1"
                                                        t-foreach="payment_term_details" t-as="term">
                                                        <div>
                                                            <span t-out="term_index + 1">1</span> -
                                                            Installment of <t
                                                                t-options='{"widget": "monetary", "display_currency": o.currency_id}'
                                                                t-out="term.get('amount')"
                                                                class="text-end">31.05</t>
                                                            <span> due
                                                            on </span>
                                                            <t t-out="term.get('date')"
                                                                class="text-start">2024-01-01</t>
                                                        </div>
                                                    </t>
                                                </div>
                                            </div>
                                        </t>
                                    </div>
                                    <!-- Mostrar QR -->
                                    <t t-set="show_qr"
                                        t-value="o.display_qr_code and o.amount_residual > 0" />
                                    <div t-if="not show_qr" name="qr_code_placeholder"
                                        class="oe_structure"></div>
                                    <div id="qrcode" class="d-flex mb-3 avoid-page-break-inside"
                                        t-else="">
                                        <div class="qrcode me-3" id="qrcode_image">
                                            <t t-set="qr_code_url"
                                                t-value="o._generate_qr_code(silent_errors=True)" />
                                            <p t-if="qr_code_url" class="position-relative mb-0">
                                                <img t-att-src="qr_code_url" />
                                                <img src="/account/static/src/img/Odoo_logo_O.svg"
                                                    id="qrcode_odoo_logo"
                                                    class="top-50 start-50 position-absolute bg-white border border-white border-3 rounded-circle"
                                                />
                                            </p>
                                        </div>
                                        <div class="d-inline text-muted lh-sm fst-italic"
                                            id="qrcode_info" t-if="qr_code_url">
                                            <p>Scan this QR Code with<br />your banking application</p>
                                        </div>
                                    </div>
                                    <!--terms
                                    and conditions-->
                                    <div class="text-muted mb-3"
                                        t-attf-style="#{'text-align:justify;text-justify:inter-word;' if o.company_id.terms_type != 'html' else ''}"
                                        t-if="not is_html_empty(o.narration)" name="comment">
                                        <span t-field="o.narration" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--  Aca irian las lineas finales de la factura -->
                    <t t-set="tax_amount_5" t-value="0" />
                    <t t-set="tax_amount_currency_5" t-value="0" />
                    <t t-set="tax_amount_10" t-value="0" />
                    <t t-set="tax_amount_currency_10" t-value="0" />
                    <t t-set="tax_amount_total" t-value="0" />
                    <t t-set="tax_amount_currency_total" t-value="0" />
                    <t t-set="tax_totals" t-value="o.tax_totals" />

                    <t t-foreach="tax_totals['subtotals']" t-as="subtotal">
                        <t t-set="tax_amount_total" t-value="subtotal['tax_amount']" />
                        <t t-set="tax_amount_currency_total"
                            t-value="subtotal['tax_amount_currency']" />
                        <t t-foreach="subtotal['tax_groups']" t-as="tax_group">
                            <t t-if="'5' in tax_group['group_name']">
                                <t t-set="tax_amount_5"
                                    t-value="tax_amount_5 + tax_group['tax_amount']" />
                                <t t-set="tax_amount_currency_5"
                                    t-value="tax_amount_currency_5 + tax_group['tax_amount_currency']" />
                            </t>
                            <t t-if="'10' in tax_group['group_name']">
                                <t t-set="tax_amount_10"
                                    t-value="tax_amount_10 + tax_group['tax_amount']" />
                                <t t-set="tax_amount_currency_10"
                                    t-value="tax_amount_currency_10 + tax_group['tax_amount_currency']" />
                            </t>
                        </t>
                    </t>

                    <div>
                        <!-- Linea del SubTotal -->
                        <table class="o_has_total_table table o_main_table table-border">
                            <tr>
                                <td class="text-nowrap text-start col-2">
                                    <strong>TOTAL: </strong>
                                </td>
                                <td
                                    t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                    <strong
                                        t-out="tax_totals['total_amount_currency']"
                                        t-options='{"widget": "monetary", "display_currency": o.currency_id}'>
                                        0</strong>
                                </td>
                            </tr>
                        </table>
                        <!-- Linea del Texto -->
                        <table class="o_has_total_table table o_main_table table-border">
                            <t t-if="o.company_id.display_invoice_amount_total_words">
                                <tr>
                                    <td>
                                        <strong>Total a pagar: </strong>
                                    </td>
                                    <td t-attf-class="text-start">
                                        <small class="text-muted lh-sm">
                                            <span t-field="o.amount_total_words">Thirty one dollar
                                                and Five cents</span>
                                        </small>
                                    </td>
                                </tr>
                            </t>
                        </table>
                        <table class="o_has_total_table table o_main_table table-border">
                            <!-- Linea de IVA en la moneda de la factura -->
                            <tr>
                                <td>
                                    <strong>Liquidación IVA:</strong>
                                </td>
                                <td t-attf-class="text-end">(5%):</td>
                                <td
                                    t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                    <strong class="text-nowrap" t-out="tax_amount_currency_5"
                                        t-options='{"widget": "monetary", "display_currency": o.currency_id}'>
                                        0</strong>
                                </td>

                                <td t-attf-class="text-end">
                                    <strong>(10%):</strong>
                                </td>
                                <td
                                    t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                    <strong class="text-nowrap" t-out="tax_amount_currency_10"
                                        t-options='{"widget": "monetary", "display_currency": o.currency_id}'>
                                        0</strong>
                                </td>

                                <td t-attf-class="text-end">
                                    <strong>TOTAL:</strong>
                                </td>
                                <td
                                    t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                    <strong class="text-nowrap" t-out="tax_amount_currency_total"
                                        t-options='{"widget": "monetary", "display_currency": o.currency_id}'>
                                        0</strong>
                                </td>


                            </tr>

                            <!-- Linea de IVA en la moneda local, solo si es diferente -->
                            <t t-if="o.tax_totals.get('display_in_company_currency')">
                                <tr>
                                    <td>
                                        <strong>Liquidación IVA (Guaranies):</strong>
                                    </td>
                                    <td t-attf-class="text-end">
                                        <strong>(5%):</strong>
                                    </td>
                                    <td
                                        t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                        <strong class="text-nowrap" t-out="tax_amount_5"
                                            t-options='{"widget": "monetary", "display_currency": o.company_currency_id}'>
                                            0</strong>
                                    </td>

                                    <td t-attf-class="text-end">
                                        <strong>(10%):</strong>
                                    </td>
                                    <td
                                        t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                        <strong class="text-nowrap" t-out="tax_amount_10"
                                            t-options='{"widget": "monetary", "display_currency": o.company_currency_id}'>
                                            0</strong>
                                    </td>

                                    <td t-attf-class="text-end">
                                        <strong>TOTAL:</strong>
                                    </td>
                                    <td
                                        t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                        <strong class="text-nowrap" t-out="tax_amount_total"
                                            t-options='{"widget": "monetary", "display_currency": o.company_currency_id}'>
                                            0</strong>
                                    </td>

                                </tr>
                            </t>
                        </table>
                    </div>
                </t>
            </xpath>
        </template>

        <template id="document_tax_totals_template">
            <!--
                Generic template to display tax totals in pdf reports.
                Used by invoices, SO and PO.

                ARGUMENTS:
                - currency: The res.currency to use.
                - tax_totals: dict in the form generated by account.move's _get_tax_totals.
            -->
            <t t-set="same_tax_base" t-value="tax_totals['same_tax_base']" />

            <tr t-if="'cash_rounding_base_amount_currency' in tax_totals">
                <td>Rounding</td>
                <td class="text-end">
                    <span t-out="tax_totals['cash_rounding_base_amount_currency']"
                        t-options='{"widget": "monetary", "display_currency": currency}'
                    >0</span>
                </td>
            </tr>


        </template>

        <!-- Allow edits (e.g. studio) without changing the often inherited base template -->
        <template id="document_tax_totals" inherit_id="l10n_aipy.document_tax_totals_template"
            primary="True"></template>

        <!-- Workaround for Studio reports, see odoo/odoo#60660 -->
        <template id="report_invoice" inherit_id="account.report_invoice">
            <xpath expr='//t[@t-call="account.report_invoice_document"]' position="after">
                <t t-elif="o._get_name_invoice_report() == 'l10n_aipy.report_invoice_document'"
                    t-call="l10n_aipy.report_invoice_document"
                    t-lang="lang" />
            </xpath>
        </template>

    </data>
</odoo>

<!--
- tax_totals: dict in the form generated by account.move's _get_tax_totals.

        :return: A dictionary containing:
            currency_id:                            The id of the currency used.
            currency_pd:                            The currency rounding (to be used js-side by the widget).
            company_currency_id:                    The id of the company's currency used.
            company_currency_pd:                    The company's currency rounding (to be used js-side by the widget).
            has_tax_groups:                         Flag indicating if there is at least one involved tax group.
            same_tax_base:                          Flag indicating the base amount of all tax groups are the same and it's
                                                    redundant to display them.
            base_amount_currency:                   The untaxed amount expressed in foreign currency.
            base_amount:                            The untaxed amount expressed in local currency.
            tax_amount_currency:                    The tax amount expressed in foreign currency.
            tax_amount:                             The tax amount expressed in local currency.
            total_amount_currency:                  The total amount expressed in foreign currency.
            total_amount:                           The total amount expressed in local currency.
            cash_rounding_base_amount_currency:     The delta added by 'cash_rounding' expressed in foreign
currency.
                                                    If there is no amount added, the key is not in the result.
            cash_rounding_base_amount:              The delta added by 'cash_rounding' expressed in local currency.
                                                    If there is no amount added, the key is not in the result.
            subtotals:                              A list of subtotal (like "Untaxed Amount"), each one being a python dictionary
                                                    containing:
                base_amount_currency:                   The base amount expressed in foreign currency.
                base_amount:                            The base amount expressed in local currency.
                tax_amount_currency:                    The tax amount expressed in foreign currency.
                tax_amount:                             The tax amount expressed in local currency.
                tax_groups:                             A list of python dictionary, one for each tax group, containing:
                    id:                                     The id of the account.tax.group.
                    group_name:                             The name of the group.
                    group_label:                            The short label of the group to be displayed on POS receipt.
                    involved_tax_ids:                       A list of the tax ids aggregated in this tax group.
                    base_amount_currency:                   The base amount expressed in foreign currency.
                    base_amount:                            The base amount expressed in local currency.
                    tax_amount_currency:                    The tax amount expressed in foreign currency.
                    tax_amount:                             The tax amount expressed in local currency.
                    display_base_amount_currency:           The base amount to display expressed in foreign currency.
                                                            The flat base amount and the amount to be displayed are sometimes different
                                                            (e.g. division/fixed taxes).
                    display_base_amount:                    The base amount to display expressed in local currency.
                                                            The flat base amount and the amount to be displayed are sometimes different
                                                            (e.g. division/fixed taxes).

-->